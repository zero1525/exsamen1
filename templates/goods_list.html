{% extends 'base.html' %}
{% block content %}

<h1>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h1>

<div class="goods-page-layout">

  <div class="sidebar">
    <div class="filter-block">
      <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
      <ul>
        <li>
          <a href="{% url 'goods_list' %}{% if selected_brand %}?brand={{ selected_brand }}{% endif %}">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
        </li>
        {% for category in categories %}
        <li>
          <a href="{% url 'goods_list' %}?category={{ category.pk }}{% if selected_brand %}&brand={{ selected_brand }}{% endif %}">
            {% if selected_category == category.pk|stringformat:"s" %}
              <strong>{{ category.name }}</strong>
            {% else %}
              {{ category.name }}
            {% endif %}
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>

    <div class="filter-block">
      <h3>–ë—Ä–µ–Ω–¥—ã</h3>
      <ul>
        <li>
          <a href="{% url 'goods_list' %}{% if selected_category %}?category={{ selected_category }}{% endif %}">–í—Å–µ –±—Ä–µ–Ω–¥—ã</a>
        </li>
        {% for brand in brands %}
        <li>
          <a href="{% url 'goods_list' %}?brand={{ brand.pk }}{% if selected_category %}&category={{ selected_category }}{% endif %}">
            {% if selected_brand == brand.pk|stringformat:"s" %}
              <strong>{{ brand.name }}</strong>
            {% else %}
              {{ brand.name }}
            {% endif %}
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>

    <div class="filter-block">
      <h3>–ü–æ–∏—Å–∫</h3>
      <form method="get" action="{% url 'goods_list' %}">
        <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫" value="{{ search_q }}">
        {% if selected_category %}
          <input type="hidden" name="category" value="{{ selected_category }}">
        {% endif %}
        {% if selected_brand %}
          <input type="hidden" name="brand" value="{{ selected_brand }}">
        {% endif %}
        <button type="submit">–ò—Å–∫–∞—Ç—å</button>
      </form>
    </div>

    {% if selected_category or selected_brand or search_q %}
      <p><a href="{% url 'goods_list' %}">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a></p>
    {% endif %}
  </div>

  <div class="main-content">
    <div class="goods-grid">
      {% for item in goods %}
      <div class="goods-card">
        {% if item.img %}
          <img src="{{ item.img.url }}" alt="{{ item.name }}">
        {% endif %}
        <h4>{{ item.name }}</h4>
        <p>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ item.category.name }}</p>
        <p>–ë—Ä–µ–Ω–¥: {{ item.brand.name }}</p>
        <p>–¶–µ–Ω–∞: {{ item.price }}</p>

        <div class="goods-actions-card">
          <a href="{% url 'goods_detail' item.pk %}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
          <!-- üß© –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –≤–º–µ—Å—Ç–æ good.pk ‚Üí item.pk, –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å—Å—ã–ª–∫–∞ -->
          <a href="{% url 'add_to_basket' item.pk %}" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
            –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
          </a>
        </div>
      </div>
      {% empty %}
        <p>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º.</p>
      {% endfor %}
    </div>

    {% if is_paginated %}
    <div class="pagination">
      {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_brand %}&brand={{ selected_brand }}{% endif %}{% if search_q %}&q={{ search_q }}{% endif %}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
      {% endif %}

      <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if selected_brand %}&brand={{ selected_brand }}{% endif %}{% if search_q %}&q={{ search_q }}{% endif %}">–°–ª–µ–¥—É—é—â–∞—è</a>
      {% endif %}
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}
